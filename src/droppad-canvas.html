<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="droppad-canvas">
  <template>
    <style>
      :host {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 0;
        width: 100vw;
        height: 100vh;
      }
      #crossX, #crossY, #pastePosition {
        display: block;
        box-sizing: border-box;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
      }
      #crossX {
        height: 50%;
        width: 100%;
        border-bottom: 1px dashed lightgray;
      }
      #crossY {
        width: 50%;
        height: 100%;
        border-right: 1px dashed lightgray;
      }

      #pastePosition {
        width: 7px;
        height: 7px;
        border-right: 2px dotted red;
        border-bottom: 2px dotted red;
      }

    </style>
    <slot></slot>
    <div id="crossX"></div>
    <div id="crossY"></div>
    <div id="pastePosition" style$="top: [[position.1]]px; left: [[position.0]]px"></div>
  </template>

  <script>
    class DroppadCanvas extends Polymer.Element {
      static get is() {
        return "droppad-canvas";
      }

      static get config() {
        return {
          properties: {
            selected: Object,
            position: {
              type: Array,
              value: function() {
                return [0, 0];
              },
              notify: true
            },
            center: {
              type: Object,
              value: function(){
                return {};
              },
              notify: true
            }
          }
        }
      }

      connectedCallback() {
        this.calcCenter();
        this.addEventListener("click", this._setPosition.bind(this));
        this.addEventListener("dblclick", this.addDrop.bind(this));
        window.addEventListener("keydown", this.registerKey.bind(this));
        window.addEventListener("resize", this.calcCenter.bind(this));
      }

      registerKey(e) {
//        let value = (e.type == "keydown");
//        switch (e.code) {
//          case "KeyR":
//            this.shift = value;
//            return;
//          case "KeyE":
//            this.ctrl = value;
//            return;
//          case "KeyW":
//            this.alt = value;
//            return;
//        }
//        if (!value && e.code == "KeyM")
//          this.mirror();
//        else if (!value && e.code == "KeyT")
//          this.info.centered = !this.info.centered;
//        this.notifyInfo();
      }

      _setPosition(e) {
        this.position = [e.x - this.center.x, e.y - this.center.y];
        this.notifyPath("position");
      }

      addDrop(e){
        this.dispatchEvent(new CustomEvent("new-drop", {detail: {x: e.x-this.center.x, y: e.y-this.center.y }}));
      }

      calcCenter(){
        this.center = {
          x: window.innerWidth/2,
          y: window.innerHeight/2
        }
      }
    }
    customElements.define(DroppadCanvas.is, DroppadCanvas);
  </script>
</dom-module>