<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="letter-shape.html">
<link rel="import" href="shape-info.html">
<link rel="import" href="shape-keyboard.html">
<link rel="import" href="shape-links.html">
<link rel="import" href="shape-json.html">

<dom-module id="my-app">
    <template>
        <style>
            :host {
                display: block;
            }
            #cross {
                position: absolute;
                bottom: 20%;
                left: 20%;
                width: 60%;
                height: 50%;
                border: 1px dotted black;
                border-right: none;
                border-top: none;
            }
        </style>

        <div id="cross">&nbsp;</div>

        <shape-links id="links"></shape-links>

        <shape-json id="jsonish" obj="{{letters}}"></shape-json>

        <iron-selector selected="{{selected}}" selected-attribute="selected">
            <template is="dom-repeat" items="[[letters]]">
                <shape-info on-propchange="setAsSelectedAlso" input="[[item]]">
                    <letter-shape input="[[item]]" counter="42"></letter-shape>
                </shape-info>
            </template>
        </iron-selector>
        <shape-keyboard on-changeprop="updateSelectedElementInfo"></shape-keyboard>
    </template>

    <script>
        Polymer({
            is: 'my-app',
            properties: {
                letters: {
                    type: Array,
//                    observer: "notifyDeepChangeOnLetters"
//                               here i also want a deep observer on both the array object and its children
//                               if i had that, then i could avoid listening for the events when data changes and
//                               only get called when the observer is triggered.
                },
                selected: Number
            },
            updateSelectedElementInfo: function (e) {
                this.shadowRoot.querySelector("[selected]").updatePropertyFieldsRelative(e);
                this.notifyDeepChangeOnLetters();
            },
            setAsSelectedAlso: function (e) {
                e.target.click();
                this.notifyDeepChangeOnLetters();
            },
            hideNames: function () {
                var names = this.shadowRoot.querySelectorAll(".shapeName");
                names.forEach(function (el) {
                    el.style.display = checkbox.checked ? "initial": "none";
                });
            },
            notifyDeepChangeOnLetters: function () {
                // this.notifyPath("letters[*].*.*"); is what i want to do on only the jsonish..
                // In order to do that, i instead call this function
                this.$.jsonish.updateObjToText();
            }
        });
    </script>
</dom-module>
