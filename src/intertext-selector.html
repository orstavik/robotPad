<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="intertext-selector">
    <template>
        <style>
            :host {
                display: flex;
                align-items: center;
                justify-content: center;
                position: absolute;
                top: 0;
                width: 100vw;
                height: 70vh;
            }
        </style>
        <slot on-mousedown="setSelect"></slot>
    </template>

    <script>
        class IntertextSelector extends Polymer.Element {
            static get is() {
                return "intertext-selector";
            }

            static get config() {
                return {
                    properties: {
                        radioButton: {
                            type: Boolean,
                            value: false
                        },
                        selected: Object
                    }
                }
            }

            setSelect(e) {
                var nevv = this._getDataSelectable(e.target);
                var old = this._deselect(nevv);
                if (!nevv)
                    return;
                nevv.setAttribute("data-selected", true);
                nevv.classList.add("data-selected");
                this.selected = nevv;
                this.dispatchEvent(new CustomEvent("select", {detail: {now: this.selected, before: old}}));
            }

            _deselect(nevv) {
                if (!this.selected)
                    return;
                if (this.radioButton && !nevv)
                    return;
                this.selected.classList.remove("data-selected");
                this.selected.removeAttribute("data-selected");
                return this.selected;
            }

            _getDataSelectable(nevv) {
                while (!nevv.hasAttribute("data-selectable")) {
                    nevv = nevv.parentNode || nevv.host;
                    if (nevv === this)
                        return null;
                }
                return nevv;
            }
        }
        customElements.define(IntertextSelector.is, IntertextSelector);
    </script>
</dom-module>