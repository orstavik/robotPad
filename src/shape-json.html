<link rel="import" href="json-object.html">

<dom-module id="shape-json">
    <template>
        <style>
            :host {
                position: absolute;
                bottom: 0;
                right: 0;
            }

            #textbox {
                width: 300px;
                height: 200px;
                clear: both;
            }
            json-object {
                position: fixed;
                top: 0;
                left: 0;
            }
        </style>

        <textarea id="textbox" value="{{txtInArea::input}}"></textarea>
        <json-object obj="{{obj}}"></json-object>

    </template>

    <script>
        Polymer({
            is: 'shape-json',

            properties: {
                obj: {
                    type: Object,
                    observer: "updateObjToText",
                    //this does not work because the changes are not deep enough.
                    //and it is not possible to put in a deep listener here, because the object is an array, and it might be changes on its children
                    //this is a limitation of the shallow observer method in Polymer
                    //this is the path into Redux. Where you want all rendering to be redone for changes in such a deep changes in a big "state object"
                    //the Redux idea is that you solve this problem of checking for updates in many deep objects, by just assuming everything has changed and
                    //then do the work all the time, instead of checking to see if you need to do the job first.
                    //because the act of checking is assumed so costly and the act of actually implementing changes assumed so small.
                    notify: true
                },
                txtInArea: {
                    type: String,
                    value: '[{"letter":"yell","color":"crimson","link":' +
                    '"http://vignette3.wikia.nocookie.net/thesimssocial/images/b/b3/Dog-Bone-(item).png/revision/latest?cb=20121122020046",' +
                    '"position":{"x":211,"y":244}},' +
                    '{"letter":"s","color":"red","position":{"x":429,"y":212}},' +
                    '{"letter":"t","color":"blue","position":{"x":111,"y":414},"scale":1.8400000000000007,"rotation":62.17591364049903},' +
                    '{"letter":"c","color":"green","position":{"x":478,"y":420},"rotation":119.57783868126133}]',
                    observer: "updateTextToObj"
                }

            },
            updateObjToText: function () {
                this.set("txtInArea", this.prepText());
            },
            updateTextToObj: function (e) {
//                var txt = this.stripTextFromHTML(e);
//                console.log(txt);
//                this.set("obj", JSON.parse(txt));
                this.set("obj", JSON.parse(this.txtInArea));
            },
            prepText: function () {
//                console.log(this.obj);
                return JSON.stringify(this.obj);
//                return this.syntaxHighlight(JSON.stringify(this.obj));
            },
            stripTextFromHTML: function (html) {
                var tmp = document.createElement("DIV");
                tmp.innerHTML = html;
                return tmp.textContent || tmp.innerText;
            }
        });
    </script>
</dom-module>
