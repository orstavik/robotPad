<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="letter-shape.html">
<link rel="import" href="shape-draggable.html">
<link rel="import" href="shape-resizeable.html">
<link rel="import" href="shape-rotatable.html">
<link rel="import" href="shape-info.html">
<link rel="import" href="shape-keyboard.html">

<dom-module id="my-app">
    <template>
        <style>
            :host {
                display: block;
            }

            #cross {
                position: absolute;
                bottom: 20%;
                left: 20%;
                width: 60%;
                height: 50%;
                border: 1px dotted black;
                border-right: none;
                border-top: none;
            }

            #input {
                width: 50%;
                height: 50px;
            }

            .bottom {
                position: absolute;
                bottom: 0;
                right: 0;
                width: 50px;
                height: 25px;
            }

            #output2 {
                bottom: 25px;
            }

            #outputText {
                position: absolute;
                bottom: 0;
                right: 50px;
                width: 300px;
                height: 50px;
            }
        </style>

        <div id="cross">&nbsp;</div>

        <textarea id="input">s:red t:blue bone c:green</textarea>
        <button id="button" on-click="initShapes">Apply</button>

        <button id="output2" class="bottom" on-click="loadData">load</button>
        <textarea id="outputText" class="bottom">Output</textarea>
        <button id="output" class="bottom" on-click="saveData">save</button>

        <iron-selector selected="{{selected}}" selected-attribute="selected">
            <template is="dom-repeat" items="[[letters]]">
                <shape-info on-propchange="setAsSelectedAlso" letter="[[item]]">
                    <shape-rotatable>
                        <shape-resizeable>
                            <shape-draggable>
                                <letter-shape input$="[[item]]" counter="42"></letter-shape>
                            </shape-draggable>
                        </shape-resizeable>
                    </shape-rotatable>
                </shape-info>
            </template>
        </iron-selector>
        <shape-keyboard on-changeprop="updateSelectedElementInfo"></shape-keyboard>
    </template>

    <script>
        Polymer({
            is: 'my-app',
            properties: {
                letters: {
                    type: Array,
                    value: function () {
                        return [];
                    }
                },
                selected: {
                    type: Number
                }
            },
            initShapes: function () {
                var text = this.$.input.value;
                this.set("letters", text.split(" "));
            },
            updateSelectedElementInfo: function (e) {
                this.shadowRoot.querySelector("[selected]").updatePropertyFieldsRelative(e);
            },
            setAsSelectedAlso: function (e) {
                e.target.click();
            },
            hideNames: function () {
                var names = this.shadowRoot.querySelectorAll(".shapeName");
                names.forEach(function (el) {
                    if (checkbox.checked)
                        el.style.display = "initial";
                    else {
                        el.style.display = "none";
                    }
                });
            },
            saveData: function (e) {
                var shapes = this.shadowRoot.querySelectorAll("shape-info");
                var resArray = [];
                shapes.forEach(function (element) {
                    resArray.push(element.getElementInfo());
                });
                this.$.outputText.innerHTML = JSON.stringify(resArray);
            },
            loadData: function (e) {
                sI = 0;
                cI = 0;
                tI = 0;
                custI = 0;
                var shapes = this.shadowRoot.querySelectorAll(".shape");
                shapes.forEach(function (el) {
                    el.remove();
                });
                textarea.value = "";
                var results = JSON.parse(outputText.value);
                for (var i = 0; i < results.length; i++)
                    textarea.value += results[i].type + " ";
                button.click();
                shapes = this.shadowRoot.querySelectorAll(".shape");
                for (i = 0; i < results.length; i++) {
                    var data = results[i].args;
                    var shape = shapes[i];
                    this.selectShape(shape);
                    this.updateXYWithData(data);
                    this.updateElement();
                }
            }
        });
    </script>
</dom-module>
