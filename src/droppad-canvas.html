<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="droppad-canvas">
  <template>
    <style>
      :host {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 0;
        width: 100vw;
        height: 100vh;
      }

      #crossX, #crossY, #pastePosition {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
      }

      #crossX {
        height: 50%;
        width: 100%;
        border-bottom: 1px dashed lightgray;
      }

      #crossY {
        width: 50%;
        height: 100%;
        border-right: 1px dashed lightgray;
      }

      #pastePosition {
        margin-top: 50vh;
        margin-left: 50vw;
        width: 7px;
        height: 7px;
        border-right: 2px dotted red;
        border-bottom: 2px dotted red;
      }

    </style>
    <slot></slot>
    <div id="crossX"></div>
    <div id="crossY"></div>
    <div id="pastePosition" style$="top: [[position.1]]px; left: [[position.0]]px"></div>
  </template>

  <script>
    class DroppadCanvas extends Polymer.Element {
      static get is() {
        return "droppad-canvas";
      }

      static get config() {
        return {
          properties: {
            selected: Object,
            center: {
              type: Object,
              value: function () {
                return {};
              },
              notify: true
            }
          }
        }
      }

      connectedCallback() {
        this._calcCenter();
        this.addEventListener("click", this._singleClick.bind(this));
        this.addEventListener("dblclick", this._doubleClick.bind(this));
        window.addEventListener("keydown", this._registerKey.bind(this));
        window.addEventListener("resize", this._calcCenter.bind(this));
      }

      _registerKey(e) {
        if (e.code === "KeyC") {
          this.copiedShapes = this.selected.slice();
        }
        if (e.code === "KeyV") {
          for (var i = 0; i < this.copiedShapes.length; i++)
            this._addShape(this.copiedShapes[i].info);
        }
      }

      _addShape(info) {
        this._makeShape(info.makeCopy(this.position[0], this.position[1]));
      };

      //single click is called for both double and single clicks
      _singleClick(e) {
        this.position = [e.x - this.center.x, e.y - this.center.y];
      }

      _doubleClick(e) {
        this._makeShape(new ShapeInfoObject(this.position[0], this.position[1]));
      }

      _makeShape(shapeInfoObj){
        this.dispatchEvent(new CustomEvent("new-drop", {detail: shapeInfoObj}));
      }

      _calcCenter() {
        this.center = {
          x: window.innerWidth / 2,
          y: window.innerHeight / 2
        }
      }
    }
    customElements.define(DroppadCanvas.is, DroppadCanvas);
  </script>
</dom-module>