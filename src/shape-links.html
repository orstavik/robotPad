<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<dom-module id="shape-links">
    <template>
        <style>
            :host {
                display: block;
                position: fixed;
                right: 0;
                top: 0;
            }
            img, input {
                width: 14px;
                height: 14px;
            }
            input.name {
                width: 50px;
            }
            input.link {
                width: 400px;
            }
        </style>

        <firebase-document
                app-name="linksonfire"
                id="firefire"
                path="linksGoHere"
                data="{{links}}">
        </firebase-document>

        <template is="dom-repeat" items="[[_toArray(links)]]">
            <div class$="[[item.key]]">
                <img src="[[item.value.link]]" alt="image" on-dblclick="makeElement">
                <input class="name" type="text" value="[[item.value.name]]" on-input="madeChanges"/>:
                <input class="link" type="text" value="[[item.value.link]]" on-input="madeChanges"/> <br/>
            </div>
        </template>
        <button on-click="addRow">Add row</button>
    </template>

    <script>
        Polymer({
            is: 'shape-links',

            properties: {
                links: Object
            },
            addRow: function () {
                var offset = {
                    name: "shortname",
                    link: "https://www.polymer-project.org/images/logos/p-logo.png"
                };
                this.set("links.created" + new Date().getTime(), offset);
            },
            makeElement: function (e) {
                var name = e.target.nextElementSibling.value;
                this.fire("nevv", {link: e.target.src, letter: name, position: {x: 200, y: 200}});
            },
            _toArray: function (arrayOrObject) {
                var ar = [];
                for (var key in arrayOrObject)
                    ar.push({key: key, value: arrayOrObject[key]});
                return ar;
            },
            madeChanges: function (e) {
                var parent = e.target.parentNode;
                var key = parent.classList.toString();
                var name = parent.children[1].value;
                var link = parent.children[2].value;
                this.set("links."+ key, {name: name, link: link});
            }
        });
    </script>
</dom-module>
