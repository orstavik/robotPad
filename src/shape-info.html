<link rel="import" href="intertext-draggable.html">
<link rel="import" href="intertext-resizeable.html">
<link rel="import" href="intertext-rotatable.html">

<dom-module id="shape-info">
    <template>
        <style>
            :host([data-selected]) #drag {
                z-index: 1000
            }

            :host([data-selected]) #rot {
                border: 2px solid black;
            }

            :host {
                display: block;
            }
        </style>
        <intertext-draggable id="drag" position="{{input.position}}" on-move="hasChanged">
            <intertext-resizeable id="resize" scale="{{input.scale}}" on-scale="hasChanged">
                <intertext-rotatable id="rot" rotation="{{input.rotation}}" on-rotate="hasChanged">
                    <slot></slot>
                </intertext-rotatable>
            </intertext-resizeable>
        </intertext-draggable>
    </template>
    <script>
        class ShapeInfo extends Polymer.Element {
            static get is() {
                return "shape-info";
            }

            static get config() {
                return {
                    properties: {
                        input: {
                            type: Object,
//                            notify: true   //this should work when the array iterator is in ship shape.
                        },

                        selected: {
                            type: Boolean,
                            observer: "updateSelected"
                        }
                    }
                };
            }

            updatePropertyFieldsRelative(e) {
                var prop = e.detail.propName;
                var prevValue = prop === "scale" ? this.input[prop] || 1 : this.input[prop] || 0;
                var value = prevValue + e.detail.propValue;
                this.set("input." + prop, value);
            }

            updateSelected() {
                this.set("input.selected", this.selected);
            }
            hasChanged(e) {
//                this.notifyPath("input"); //this should work when the array iterator is in ship shape.
                this.dispatchEvent(new CustomEvent("changedshape", {detail: this.input}));
            }
        }
        customElements.define(ShapeInfo.is, ShapeInfo);
    </script>
</dom-module>
