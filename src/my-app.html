<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="letter-shape.html">
<link rel="import" href="shape-info.html">
<link rel="import" href="shape-keyboard.html">
<link rel="import" href="shape-links.html">
<link rel="import" href="shape-json.html">

<dom-module id="my-app">
    <template>
        <style>
            :host {
                display: block;
            }

            #cross {
                position: absolute;
                bottom: 20%;
                left: 20%;
                width: 60%;
                height: 50%;
                border: 1px dotted black;
                border-right: none;
                border-top: none;
            }
        </style>

        <div on-click="setSelect" selectable>
            <div id="cross">&nbsp;</div>

            <shape-links id="links"></shape-links>

            <shape-json id="jsonish" obj="{{letters}}" on-edited="deepNotifyLetters"></shape-json>

            <!--<iron-selector selected="{{selected}}" selected-attribute="selected">-->
            <template is="dom-repeat" items="[[letters]]">
                <shape-info on-propchange="deepNotifyLetters" input="[[item]]" selectable>
                    <letter-shape input="[[item]]" counter="42"></letter-shape>
                </shape-info>
            </template>
        </div>
        <!--</iron-selector>-->
        <shape-keyboard on-changeprop="updateSelectedElementInfo"></shape-keyboard>
    </template>

    <script>
        Polymer({
            is: 'my-app',
            properties: {
                letters: Array,
                selected: Number
            },
            updateSelectedElementInfo: function (e) {
                this.shadowRoot.querySelector("[selected]").updatePropertyFieldsRelative(e);
                this.deepNotifyLetters();
            },
            deepNotifyLetters: function () {
                this.deepNotify("letters");
            },
            setSelect: function (e) {
                var old = this.$$("[selected]");
                if(old)
                    old.removeAttribute("selected");
                var nevv = e.target;
                while(!nevv.hasAttribute("selectable"))
                    nevv = nevv.parentNode || nevv.host;
                nevv.setAttribute("selected", true);
                this.deepNotifyLetters();
            },
            hideNames: function () {
                var names = this.shadowRoot.querySelectorAll(".shapeName");
                names.forEach(function (el) {
                    el.style.display = checkbox.checked ? "initial" : "none";
                });
            },
            deepNotify: function (key) {
                var tmp = this[key];
                this.set(key, []);
                this.set(key, tmp);
            }
        });
    </script>
</dom-module>
