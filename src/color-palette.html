<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="key-flower.html">

<dom-module id="color-palette">
  <template>
    <style>
      :host {
        display: flex;
        box-sizing: border-box;
        flex-direction: column;
        width: 370px;
        height: 250px;
        padding: 15px;
      }
      .flowerBox {
        display: inline-block;
        margin: 0 6px;
      }
      .firstRow {
        display: flex;
        justify-content: flex-start;
        margin-bottom: 10px;
      }
      .box12, .box9 {
        display: inline-block;
        width: 92px;
        margin: 0 6px;
      }
      .color {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin: 0 1px;
        border-radius: 3px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                    0 1px 5px 0 rgba(0, 0, 0, 0.12),
                    0 3px 1px -2px rgba(0, 0, 0, 0.2);
        transition-duration: 0.5s;
      }
      .secondRow {
        display: flex;
        justify-content: flex-start;
      }
      .secondRow>div {
        display: inline-block;
        width: 140px;
        padding-right: 30px;
      }
      .sliderTitle {
        font-size: 16px;
        font-weight: 300;
        line-height: 3;
        padding: 0 15px;
      }
      paper-slider {
        --paper-slider-knob-start-border-color: var(--google-blue-700);
        --paper-slider-knob-start-color: var(--google-blue-700);
        --paper-slider-pin-start-color: var(--google-blue-700);
      }
    </style>

    <div class="firstRow">
      <div class="flowerBox">
        <key-flower id="keyflower" scale="[[scale]]" palette="[[cssColors]]"></key-flower>
      </div>
      <div class="box12">
        <template is="dom-repeat" items="[[cssColors]]">
          <div id="color[[index]]" class="color" style$="background: [[item]]" on-click="_selectColor"></div>
        </template>
      </div>
      <div class="box9">
        <div id="grey0" class="color" style="background-color: var(--tone-grey-0)" on-click="_selectColor"></div>
        <div id="grey1" class="color" style="background-color: var(--tone-grey-1)" on-click="_selectColor"></div>
        <div id="grey2" class="color" style="background-color: var(--tone-grey-2)" on-click="_selectColor"></div>
        <div id="grey3" class="color" style="background-color: var(--tone-grey-3)" on-click="_selectColor"></div>
        <div id="grey4" class="color" style="background-color: var(--tone-grey-4)" on-click="_selectColor"></div>
        <div id="grey5" class="color" style="background-color: var(--tone-grey-5)" on-click="_selectColor"></div>
        <div id="grey6" class="color" style="background-color: var(--tone-grey-6)" on-click="_selectColor"></div>
        <div id="grey7" class="color" style="background-color: var(--tone-grey-7)" on-click="_selectColor"></div>
        <div id="grey8" class="color" style="background-color: var(--tone-grey-8)" on-click="_selectColor"></div>
      </div>
    </div>
    <div class="secondRow">
      <div>
        <span class="sliderTitle">Saturation</span>
        <paper-slider pin min="-100" max="100" id="s" on-change="setS"></paper-slider>
      </div>
      <div>
        <span class="sliderTitle">Lightness</span>
        <paper-slider pin min="-90" max="90" id="l" on-change="setL"></paper-slider>
      </div>
    </div>
    <!--H <input type="range" min="-90" max="90" value="0" id="h" on-input="setSunset"/> <br>-->

  </template>

  <script src="js/StaticColorMaker.js"></script>
  <script>
    class ColorPalette extends Polymer.Element {
      static get is() {
        return "color-palette";
      }

      static get config() {
        return {
          properties: {
            computedColors: {
              type: Array,
              computed: "makeComputed(l,s, sunset)",
              notify: true
            },
            cssColors: {
              type: Array,
              computed: "makeCSS(computedColors)",
              notify: true,
              observer: "_passOutNewColors"
            },
            scale: Object,
            s: {
              type: Number,
              value: 0
            },
            l: {
              type: Number,
              value: 0
            },
            sunset: {
              type: Number,
              value: 0
            }
          }
        }
      }

      _passOutNewColors(cssColors){
        this.dispatchEvent(new CustomEvent("new-colors", {composed: true, bubbles: true, detail: cssColors}));
      }

      _selectColor(e) {
        this.dispatchEvent(new CustomEvent("select-color", {composed: true, bubbles: true, detail: e.target.id}));
      }

      makeComputed(l, s, sunset) {
        return StaticColorMaker.staticColors().map(item => StaticColorMaker.calculateRGB(StaticColorMaker.calculateHSL(item, s, l), sunset / 100));
      }

      makeCSS(computedColors) {
        return computedColors.map(color => StaticColorMaker._computeHSL(color));
      }

      setS(e) {
        this.s = Number(e.target.value) / 100;
      }

      setL(e) {
        this.l = Number(e.target.value) / 100;
      }

      setSunset(e) {
        this.sunset = Number(e.target.value) / 100;
      }
    }
    customElements.define(ColorPalette.is, ColorPalette);
  </script>
</dom-module>