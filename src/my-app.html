<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="letter-shape.html">
<link rel="import" href="shape-info.html">
<link rel="import" href="shape-keyboard.html">
<link rel="import" href="shape-links.html">

<dom-module id="my-app">
    <template>
        <style>
            :host {
                display: block;
            }
            #cross {
                position: absolute;
                bottom: 20%;
                left: 20%;
                width: 60%;
                height: 50%;
                border: 1px dotted black;
                border-right: none;
                border-top: none;
            }

            #input {
                width: 50%;
                height: 50px;
            }

            .bottom {
                position: absolute;
                bottom: 0;
                right: 0;
                width: 50px;
                height: 25px;
            }

            #output2 {
                bottom: 25px;
            }

            #outputText {
                position: absolute;
                bottom: 0;
                right: 50px;
                width: 300px;
                height: 500px;
            }
        </style>

        <div id="cross">&nbsp;</div>

        <shape-links id="links"></shape-links>

        <textarea id="outputText" value="{{outputTxt}}" class="bottom" on-input="loadData"></textarea>

        <iron-selector selected="{{selected}}" selected-attribute="selected">
            <template is="dom-repeat" items="[[letters]]">
                <shape-info on-propchange="setAsSelectedAlso" input$="[[item]]">
                    <letter-shape input$="[[item]]" counter="42"></letter-shape>
                </shape-info>
            </template>
        </iron-selector>
        <shape-keyboard on-changeprop="updateSelectedElementInfo"></shape-keyboard>
    </template>

    <script>
        Polymer({
            is: 'my-app',
            properties: {
                letters: Array,
                selected: Number,
                outputTxt: {
                    type: String,
                    value: '[{"letter":"yell","color":"crimson","link":' +
                    '"http://vignette3.wikia.nocookie.net/thesimssocial/images/b/b3/Dog-Bone-(item).png/revision/latest?cb=20121122020046",' +
                    '"position":{"x":211,"y":244}},' +
                    '{"letter":"s","color":"red","position":{"x":429,"y":212}},' +
                    '{"letter":"t","color":"blue","position":{"x":111,"y":414},"scale":1.8400000000000007,"rotation":62.17591364049903},' +
                    '{"letter":"c","color":"green","position":{"x":478,"y":420},"rotation":119.57783868126133}]',
                    observer: "loadData"
                }
            },
            updateSelectedElementInfo: function (e) {
                this.shadowRoot.querySelector("[selected]").updatePropertyFieldsRelative(e);
                this.saveData(e);
            },
            setAsSelectedAlso: function (e) {
                e.target.click();
                this.saveData(e);
            },
            hideNames: function () {
                var names = this.shadowRoot.querySelectorAll(".shapeName");
                names.forEach(function (el) {
                    el.style.display = checkbox.checked ? "initial": "none";
                });
            },
            saveData: function (e) {
                var shapes = this.shadowRoot.querySelectorAll("shape-info");
                var resArray = [];
                shapes.forEach(function (element) {
                    resArray.push(element.input);
                });
                this.set("outputTxt", JSON.stringify(resArray));
            },
            loadData: function () {
                this.set("letters", JSON.parse(this.outputTxt));
            }
        });
    </script>
</dom-module>
