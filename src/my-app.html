<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="letter-shape.html">
<link rel="import" href="shape-info.html">
<link rel="import" href="shape-keyboard.html">
<link rel="import" href="shape-links.html">
<link rel="import" href="json-object.html">
<link rel="import" href="json-saver.html">
<link rel="import" href="intertext-selector.html">

<dom-module id="my-app">
    <template>

        <style>
            :host {
                display: block;
            }

            shape-info[data-selected] {
                z-index: 1000;
            }

            shape-info[data-selected] letter-shape{
                border: 2px solid black;
            }

            /*[data-selected] #rot {*/
            /*}*/


            /*[data-selected] {*/
                /*border: 2px solid red;*/
            /*}*/

            /*json-object {*/
            /*position: fixed;*/
            /*top: 0;*/
            /*left: 0;*/
            /*}*/

            #cross {
                position: absolute;
                bottom: 20%;
                left: 20%;
                width: 60%;
                height: 50%;
                border: 1px dotted black;
                border-right: none;
                border-top: none;
            }
        </style>

        <json-object key="myLetters" obj="[[letters]]" on-writeop="writeInChanges"></json-object>

        <json-saver input="[[letters]]" on-sketchload="loadSketch"></json-saver>

        <shape-links id="links" on-nevv="addLetter"></shape-links>

        <!--<div id="cross"> </div>-->

        <intertext-selector id="shapeSelector" radio-button on-select="somethingSelected">
            <template is="dom-repeat" items="[[letters]]">
                <shape-info key="[[index]]" input="[[item]]" data-selectable on-newinfo="anInfoUpdated">
                    <letter-shape input="[[item]]" counter="42"></letter-shape>
                </shape-info>
            </template>
        </intertext-selector>

        <shape-keyboard on-scale="keyScale" on-rotate="keyRotate"></shape-keyboard>

    </template>

    <script>

        class MyApp extends Polymer.Element {
            static get is() {
                return "my-app";
            }

            static get config() {
                return {
                    properties: {
                        letters: {
                            type: Array
                        }
                    },
                    observers: []
                };
            }

            loadSketch(e) {
                this.letters = JSON.parse(e.detail.json);
                this.notifyPath("letters");
            }

            somethingSelected(e, detail) {
                if (detail.before)
                    this.letters[detail.before.key].selected = false;
                this.letters[detail.now.key].selected = true;
                this.notifyPath("letters");
            }
            keyScale(e, detail) {
                var selected = this.$.shapeSelector.selected;
                if (!selected)
                    return console.log("Can't use the keys when no shape is selected");
                selected.scaleAlittle(detail);
                this.notifyPath("letters");
            }
            keyRotate(e, detail) {
                var selected = this.$.shapeSelector.selected;
                if (!selected)
                    return console.log("Can't use the keys when no shape is selected");
                selected.rotateAlittle(detail);
                this.notifyPath("letters");
            }

            anInfoUpdated(e, detail) {
//                this.letters[detail.key] = detail.value;
                this.notifyPath("letters");
            }

            addLetter(e) {
                this.letters.push(e.detail);
                this.notifyPath("letters");
            }

            writeInChanges(e, detail) {
//                this.letters = detail[1];
                this.notifyPath("letters");
            }

            connectedCallback() {
                super.connectedCallback();
                var start = '[{"letter":"yell","color":"crimson","link":' +
                        '"http://vignette3.wikia.nocookie.net/thesimssocial/images/b/b3/Dog-Bone-(item).png/revision/latest?cb=20121122020046",' +
                        '"position":{"x":211,"y":244}},' +
                        '{"letter":"a","color":"red","link":"../images/keys/a.png","position":{"x":429,"y":212}},' +
                        '{"letter":"f","color":"blue","link":"../images/keys/f.png","position":{"x":111,"y":414},"scale":1.84,"rotation":62.17},' +
                        '{"letter":"j","color":"green","link":"../images/keys/j.png","position":{"x":478,"y":420},"rotation":119.57}]';
                this.set("letters", JSON.parse(start));
            }

        }
        customElements.define(MyApp.is, MyApp);
    </script>
</dom-module>

